*** Settings ***
Resource        ${CURDIR}/../resources/init_settings.txt

Test Setup      Login To Appliance  ${VM_name}

Force Tags        rest


*** Keywords ***
Login To Appliance
    [Arguments]     ${VM_name}
    Import Library  ${CURDIR}/../resources/EsxiLib.py    ip=${VSPHERE_IP}    username=${VSPHERE_USERNAME}   password=${VSPHERE_PASSWORD}    WITH NAME   EsxiLib
    ${ip}=  Get Variable Value  ${CIRRUS_VM_IP}
    ${ip}=  Run Keyword If  '${ip}' == 'None'  EsxiLib.Get IP  vmname=${VM_name}  ELSE  Get Variable Value  ${ip}
    Import Library  ${CURDIR}/../resources/CirrusRESTLib.py    ip=${ip}    WITH NAME   Cirrus
    ${resp}=    Login Cirrus    ${CIRRUS_ADMIN_USERNAME}    ${CIRRUS_ADMIN_PASSWORD}
    Log to Console      ${ip}
    Should Be Equal As Strings    ${resp}    200

*** Test Cases ***
Save Test Plans
    [Tags]  rat
    ${resp}=    Add Test Plan   ${CURDIR}/../testdata/testplan_sleep.json
    Should Be Equal As Strings    ${resp}    200
    ${resp}=    Compare Test Plan Content   testplan_sleep.json     ${CURDIR}/../testdata/testplan_sleep.json
    Should Be Equal As Strings    ${resp}    200
    ${resp}=    Add Test Plan   ${CURDIR}/../testdata/testplan_to_be_deleted.json
    Should Be Equal As Strings    ${resp}    200
    ${resp}=    Compare Test Plan Content   testplan_to_be_deleted.json     ${CURDIR}/../testdata/testplan_to_be_deleted.json
    Should Be Equal As Strings    ${resp}    200

Edit Test Plan
    [Tags]  rat
    ${resp}=    Edit Test Plan   testplan_to_be_deleted.json    ${CURDIR}/../testdata/testplan_to_be_deleted_new.json
    Should Be Equal As Strings    ${resp}    200

Submit Test Plan
    [Tags]  rat
    ${resp}=    Submit Test Plan   ${CURDIR}/../testdata/testplan_sleep.json
    Should Be Equal As Strings    ${resp[0]}    200
    ${status}=    Check Job Status    ${resp[1]}
    Should Be Equal As Strings    ${status}    pass

Delete Test Plan
    [Tags]  rat
    ${resp}=    Delete Test Plan    testplan_to_be_deleted_new.json
    Should Be Equal As Strings    ${resp}    204
