*** Settings ***
Resource        ${CURDIR}/../resources/init_settings.txt
Library         ${CURDIR}/../resources/VerifyResults.py

Test Setup      Login To Appliance  ${VM_name}

Force Tags        rest


*** Keywords ***
Login To Appliance
    [Arguments]     ${VM_name}
    Import Library  ${CURDIR}/../resources/EsxiLib.py    ip=${VSPHERE_IP}    username=${VSPHERE_USERNAME}   password=${VSPHERE_PASSWORD}    WITH NAME   EsxiLib
    ${ip}=  Get Variable Value  ${CIRRUS_VM_IP}
    ${ip}=  Run Keyword If  '${ip}' == 'None'  EsxiLib.Get IP  vmname=${VM_name}  ELSE  Get Variable Value  ${ip}
    Import Library  ${CURDIR}/../resources/CirrusRESTLib.py    ip=${ip}    WITH NAME   Cirrus
    ${resp}=    Login Cirrus    ${CIRRUS_ADMIN_USERNAME}    ${CIRRUS_ADMIN_PASSWORD}
    Log to Console      ${ip}
    Should Be Equal As Strings    ${resp}    200

*** Test Cases ***
L2ADD Gracefully Abort
    [Tags]  fast
    ${resp}=    Submit Test Plan   ${CURDIR}/../testdata/l2add.json
    Should Be Equal As Strings    ${resp[0]}    200
    Sleep   30
    ${status}=    Abort Job Gracefully    ${resp[1]}
    Should Be Equal As Strings    ${status}    204
    ${status}=    Check Job Status    ${resp[1]}
    Should Be Equal As Strings    ${status}    abort

L2ADD Immediately Abort
    [Tags]  fast
    ${resp}=    Submit Test Plan   ${CURDIR}/../testdata/l2add.json
    Should Be Equal As Strings    ${resp[0]}    200
    Sleep   30
    ${status}=    Abort Job Immediately    ${resp[1]}
    Should Be Equal As Strings    ${status}    204
    ${status}=    Check Job Status    ${resp[1]}
    Should Be Equal As Strings    ${status}    abort
